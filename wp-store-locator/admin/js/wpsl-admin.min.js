jQuery(document).ready(function(e){var s,o,t,n,l,r=[],i=i||{};function a(n="wpsl-gmap-wrap"){var l,r,i,a,c=wpslSettings.defaultLatLng.split(",");t=new google.maps.LatLng(c[0],c[1]),l={zoom:parseInt(wpslSettings.defaultZoom),center:t,mapTypeId:google.maps.MapTypeId[wpslSettings.mapType.toUpperCase()],mapTypeControl:!1,streetViewControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP}},o=new google.maps.Geocoder,s=new google.maps.Map(document.getElementById(n),l),i=e("#wpsl-lat").val(),a=e("#wpsl-lng").val(),i&&a&&(r=new google.maps.LatLng(i,a),s.setCenter(r),s.setZoom(16),p(r))}function p(e,o=!0){var t=new google.maps.Marker({position:e,map:s,draggable:o});r.push(t),google.maps.event.addListener(t,"dragend",function(){c(t.getPosition(),"store")})}function c(s,o){var t=function(e){var s=[],o=e.toString().split(",",2);return s[0]=o[0].replace("(",""),s[1]=o[1].replace(")",""),s}(s),n=d(t[0]),l=d(t[1]);"store"==o?(e("#wpsl-lat").val(n),e("#wpsl-lng").val(l)):"zoom"==o&&e("#wpsl-latlng").val(n+","+l)}function d(e){return Math.round(e*Math.pow(10,6))/Math.pow(10,6)}function w(s){e("#wpsl-meta-nav li"+(s="first"==s?":first-child":"."+s)+"-tab").hasClass("wpsl-active")||(e("#wpsl-meta-nav li"+s+"-tab").addClass("wpsl-active").siblings().removeClass("wpsl-active"),e(".wpsl-store-meta > div"+s).show().addClass("wpsl-active").siblings("div").hide().removeClass("wpsl-active"))}function u(){e("#wpsl-store-hours .wpsl-icon-cancel-circled").off(),e("#wpsl-store-hours .wpsl-icon-cancel-circled").on("click",function(){!function(e){var s=g(e),o=e.parents("tr"),t=o.find(".wpsl-opening-hours").attr("data-day");1==s&&o.find(".wpsl-opening-hours").html("<p class='wpsl-store-closed'>"+wpslL10n.closedDate+"<input type='hidden' name='wpsl[hours]["+t+"_open]' value='' /></p>");e.parent().closest(".wpsl-current-period").remove(),o.find(".wpsl-opening-hours div:first-child").hasClass("wpsl-multiple-periods")&&o.find(".wpsl-opening-hours div:first-child").removeClass("wpsl-multiple-periods")}(e(this))})}function g(e){return e.parents("tr").find(".wpsl-current-period").length}function v(s){var o,t,n,l,r=!1,i=!1,a="",p="",c=[],d={hr12:[12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11],hr24:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]},w=["00","15","30","45"];l=e("#wpsl-editor-hour-format").length?e("#wpsl-editor-hour-format").val():wpslSettings.hourFormat,e("#wpsl-store-hours td").removeAttr("style"),12==l?(e("#wpsl-store-hours").removeClass().addClass("wpsl-twelve-format"),o=d.hr12):(e("#wpsl-store-hours").removeClass().addClass("wpsl-twentyfour-format"),o=d.hr24),t=w;for(var u=0;u<o.length;u++){n=o[u],12==l?(n>=12&&(r=!!i,i=!0),a=r?"PM":"AM"):24==l&&1==n.toString().length&&(n="0"+n);for(var g=0;g<t.length;g++)c.push(n+":"+t[g]+" "+a)}for(u=0;u<c.length;u++)p=p+'<option value="'+e.trim(c[u])+'">'+e.trim(c[u])+"</option>";if(s)return p;!function(s,o){var t,n,l,r={};e(".wpsl-current-period").each(function(){l=e(this),r={open:e(this).find(".wpsl-open-hour").val(),close:e(this).find(".wpsl-close-hour").val()},e(this).find("select").html(s).promise().done(function(){for(var s in r)r.hasOwnProperty(s)&&(t=r[s].split(":"),12==o?(n="",0==r[s].charAt(0)?(r[s]=r[s].substr(1),n=" AM"):2==t[0].length&&t[0]>12?(r[s]=t[0]-12+":"+t[1],n=" PM"):t[0]<12?(r[s]=t[0]+":"+t[1],n=" AM"):12==t[0]&&(r[s]=t[0]+":"+t[1],n=" PM"),-1==t[1].indexOf("PM")&&-1==t[1].indexOf("AM")&&(r[s]=r[s]+n)):24==o&&(-1!=t[1].indexOf("PM")?12==t[0]?r[s]="12:"+t[1].replace(" PM",""):r[s]=+t[0]+12+":"+t[1].replace(" PM",""):-1!=t[1].indexOf("AM")?1==t[0].toString().length?r[s]="0"+t[0]+":"+t[1].replace(" AM",""):r[s]=t[0]+":"+t[1].replace(" AM",""):r[s]=t[0]+":"+t[1]),l.find(".wpsl-"+s+"-hour option[value='"+e.trim(r[s])+"']").attr("selected","selected"))})})}(p,l)}function h(){var o="",t=e.trim(e("#wpsl-map-style").val());e(".wpsl-style-preview-error").remove(),t&&((o=function(e){try{var s=JSON.parse(e);if(s&&"object"==typeof s&&null!==s)return s}catch(e){}return!1}(t))||e("#wpsl-style-preview").after("<div class='wpsl-style-preview-error'>"+wpslL10n.styleError+"</div>")),s.setOptions({styles:o})}i.verifyKeys={init:function(){var s=this,o=e("#wpsl-verify-keys"),t=wpslSettings.url+"img/ajax-loader.gif",n=void 0!==wpslSettings.mapService?wpslSettings.mapService:"gmaps";o.on("click",function(){return e("#wpsl-wrap .notice").remove(),s[n].check(),o.after('<img src="'+t+'" class="wpsl-api-key-preloader" />'),!1})},showStatus:function(s,o,t="error"){this.createNotice(s,o,t),"browser"==o&&e(".wpsl-api-key-preloader").remove()},createNotice:function(s,o,t){var n,l;n='<div class="'+("error"==t?"error":"updated")+' notice is-dismissible">',n+="<p><strong>"+s+"</strong></p>",n+='<button type="button" class="notice-dismiss"><span class="screen-reader-text">'+wpslL10n.dismissNotice+"</span></button>",n+="</div>",l=e("#wpsl-tabs").length?"wpsl-tabs":"wpsl-settings-form",e("#"+l).before(n),"error"==t?e("#wpsl-api-"+o+"-key").addClass("wpsl-error"):e("#wpsl-api-"+o+"-key").removeClass("wpsl-error")},gmaps:{check:function(){this.server(function(){i.verifyKeys.gmaps.browser()})},server:function(s){var o,t={action:"validate_server_key",server_key:e("#wpsl-api-server-key").val()};t.server_key?e.get(wpslSettings.ajaxurl,t,function(e){o=e.valid?"updated":"error",i.verifyKeys.showStatus(e.msg,"server",o),s()}):(i.verifyKeys.showStatus(wpslL10n.serverKeyMissing,"server"),s())},browser:function(){var s;e("#wpsl-api-browser-key").val()?(s=setInterval(function(){i.verifyKeys.showStatus(wpslL10n.browserKeyError,"browser"),clearInterval(s)},3e3),o.geocode({address:"Manhattan, NY 10036, USA"},function(e,o){o==google.maps.GeocoderStatus.OK?i.verifyKeys.showStatus(wpslL10n.browserKeySuccess,"browser","success"):i.verifyKeys.showStatus(wpslL10n.browserKeyError,"browser"),clearInterval(s)})):i.verifyKeys.showStatus(wpslL10n.browserKeyMissing,"browser")}}},i.showApiResponse={init:function(){var o=e("#wpsl-geocode-input"),t=this,n=!1;e("#wpsl-show-geocode-response").on("click",function(o){return t.createDialog(),a("wpsl-geocode-preview"),e(".wpsl-geocode-warning span").length||t.createRestrictionsMsg(),google.maps.event.addListenerOnce(s,"tilesloaded",function(){n=!0,t.checkQuotaError()}),setTimeout(function(){n||(e(".wpsl-geocode-warning, #wpsl-geocode-test input, #wpsl-geocode-tabs").remove(),e(".wpsl-geocode-api-notice").show().html(wpslL10n.loadingFailed))},1e3),!1}),e("#wpsl-geocode-submit").on("click",function(s){o.removeClass("wpsl-error"),o.val()?t.geocoding.makeRequest():(o.addClass("wpsl-error"),e(".wpsl-geocode-api-notice").hide())}),e("#wpsl-geocode-test").keydown(function(s){13==(s.keyCode?s.keyCode:s.which)&&e("#wpsl-geocode-submit").trigger("click")})},createDialog:function(){e("#wpsl-geocode-test").dialog({resizable:!1,height:"auto",width:550,modal:!0,open:function(){e(this).parent().css({top:window.pageYOffset+50}),e("#wpsl-geocode-tabs").tabs(),e("#wpsl-geocode-input").focus(),e(".wpsl-geocode-api-notice").hide(),e("#wpsl-geocode-tabs").tabs("option","active",e("li").index(e("li:visible:eq(0)"))),e("#wpsl-geocode-input, #wpsl-geocode-response textarea").val(""),e(".ui-widget-overlay").bind("click",function(){e("#wpsl-geocode-test").dialog("close")})},buttons:{Cancel:function(){e(this).dialog("close")}}})},checkQuotaError:function(){setTimeout(function(){e("#wpsl-geocode-preview .dismissButton").length>0&&(e(".wpsl-geocode-warning, #wpsl-geocode-test input").remove(),e(".wpsl-geocode-api-notice").show(),e(".wpsl-geocode-api-notice span").html(wpslL10n.loadingError))},1e3)},createRestrictionsMsg:function(){var s,o,t=e(".wpsl-geocode-warning").show().find("strong");e("#wpsl-api-region").val()?(s=e("#wpsl-api-region option:selected").text(),o=e("#wpsl-force-postalcode").is(":checked")?wpslL10n.restrictedZipCode:"",t.after("<span>"+wpslL10n.resultsWarning+" "+s+" "+o+"</span>")):(t.after("<span>"+wpslL10n.noRestriction+"</span>"),e(".wpsl-region-href").on("click",function(){e(".ui-widget-overlay").trigger("click")}))},geocoding:{makeRequest:function(){var n=this.createParams();o.geocode(n,function(o,n){"OK"==n||"ZERO_RESULTS"==n?(void 0!==r[0]&&(r[0].setMap(null),r.length=0),"OK"==n?(p(o[0].geometry.location,!1),s.setZoom(12),s.setCenter(o[0].geometry.location)):(s.setZoom(parseInt(wpslSettings.defaultZoom)),s.setCenter(t))):(n=wpslL10n.browserKeyError,e("#wpsl-geocode-preview, #wpsl-geocode-response textarea").remove()),e(".wpsl-geocode-api-notice").show(),e(".wpsl-geocode-api-notice span").html(n),e("#wpsl-geocode-response textarea").val(JSON.stringify(o,null,4))})},createParams:function(){var s={};return void 0===wpslSettings.geocodeComponents||e.isEmptyObject(wpslSettings.geocodeComponents)?s.address=e("#wpsl-geocode-input").val():(s.componentRestrictions=wpslSettings.geocodeComponents,void 0!==s.componentRestrictions.postalCode?s.componentRestrictions.postalCode=e("#wpsl-geocode-input").val():s.address=e("#wpsl-geocode-input").val()),s}}},e("#wpsl-gmap-wrap").length&&a(),e("#wpsl-map-settings").length&&(i.verifyKeys.init(),i.showApiResponse.init()),e("#wpsl-start-name").length&&(n=document.getElementById("wpsl-start-name"),l=new google.maps.places.Autocomplete(n,{types:["geocode"]}),google.maps.event.addListener(l,"place_changed",function(){c(l.getPlace().geometry.location,"zoom")})),e("#wpsl-lookup-location").on("click",function(t){var n,l;t.preventDefault(),!function(){var s,o,t=!1;if(e(".wpsl-store-meta input").removeClass("wpsl-error"),void 0!==wpslSettings.requiredFields&&_.isArray(wpslSettings.requiredFields))for(o=wpslSettings.requiredFields,s=0;s<o.length;s++)e.trim(e("#wpsl-"+o[s]).val())||(e("#wpsl-"+o[s]).addClass("wpsl-error"),t=!0);return t}()?(l=function(){var s,o,t=[],n=["address","city","state","zip","country"];for(s=0;s<n.length;s++)(o=e.trim(e("#wpsl-"+n[s]).val()))&&t.push(o),o="";return t.join()}(),o.geocode({address:l},function(o,t){t===google.maps.GeocoderStatus.OK?(void 0!==r[0]&&r[0].draggable&&(r[0].setMap(null),r.splice(0,1)),s.setCenter(o[0].geometry.location),s.setZoom(16),p(o[0].geometry.location),c(o[0].geometry.location,"store"),n=function(e){var s,o,t={},n=e[0].address_components.length;for(s=0;s<n;s++)o=e[0].address_components[s].types,/^country,political$/.test(o)&&(t={long_name:e[0].address_components[s].long_name,short_name:e[0].address_components[s].short_name});return{country:t}}(o),e("#wpsl-country").val(n.country.long_name),e("#wpsl-country_iso").val(n.country.short_name)):alert(wpslL10n.geocodeFail+": "+t)})):(w("first"),alert(wpslL10n.missingGeoData))}),e(".wpsl-marker-list input[type=radio]").click(function(){e(this).parents(".wpsl-marker-list").find("li").removeClass(),e(this).parent("li").addClass("wpsl-active-marker")}),e(".wpsl-marker-list li").click(function(){e(this).parents(".wpsl-marker-list").find("input").prop("checked",!1),e(this).find("input").prop("checked",!0),e(this).siblings().removeClass(),e(this).addClass("wpsl-active-marker")}),e(".wpsl-has-conditional-option").on("change",function(){e(this).parent().next(".wpsl-conditional-option").toggle()}),e("#wpsl-store-template").on("change",function(){var s=e("#wpsl-listing-below-no-scroll");"below_map"==e(this).val()?s.show():s.hide()}),e("#wpsl-api-region").on("change",function(){var s=e("#wpsl-geocode-component");e(this).val()?s.show():s.hide()}),e("#wpsl-editor-hour-input").on("change",function(){e(".wpsl-"+e(this).val()+"-hours").show().siblings("div").hide(),e(".wpsl-hour-notice").toggle()}),e("#wpsl-meta-nav li").on("click",function(s){var o=e(this).attr("class");o=o.split("-tab"),s.stopPropagation(),e(this).addClass("wpsl-active").siblings().removeClass("wpsl-active"),e(".wpsl-store-meta ."+o[0]).show().addClass("wpsl-active").siblings("div").hide().removeClass("wpsl-active")}),e("#wpsl-store-details").length&&e("#publish").click(function(){var s,o,t,n='<div id="message" class="error"><p>'+wpslL10n.requiredFields+"</p></div>",l=!1;return e("#wpbody-content .wrap #message").remove(),e(".wpsl-required").removeClass("wpsl-error"),e(".wpsl-required").each(function(){""==e(this).val()&&(e(this).addClass("wpsl-error"),void 0===s&&(s=function(e){var s={type:"id",val:e.attr("id")};void 0===s.val&&(s={type:"class",val:e.attr("class")});return s}(e(this))),l=!0)}),!l||(e("#wpbody-content .wrap > h2").after(n),void 0!==s.val&&("id"==s.type?(o=e("#"+s.val).parents(".wpsl-tab").attr("class"),e("html, body").scrollTop(Math.round(e("#"+s.val).offset().top-100))):"class"==s.type&&(t=s.val.replace(/wpsl-required|wpsl-error/g,""),o=e("."+t).parents(".wpsl-tab").attr("class"),e("html, body").scrollTop(Math.round(e("."+t).offset().top-100))),o=e.trim(o.replace(/wpsl-tab|wpsl-active/g,""))),w(o||"first"),e("#publish").removeClass("button-primary-disabled"),e(".spinner").hide(),!1)}),e("#wpsl-store-hours").length&&u(),e(".wpsl-add-period").on("click",function(s){var o,t={},n=e(this).parents("tr"),l=g(e(this))>=1?"wpsl-current-period wpsl-multiple-periods":"wpsl-current-period",r=n.find(".wpsl-opening-hours").attr("data-day"),i=e("#wpsl-settings-form").length?"wpsl_editor[dropdown]":"wpsl[hours]";o='<div class="'+l+'">',o+='<select autocomplete="off" name="'+i+"["+r+'_open][]" class="wpsl-open-hour">'+v(!0)+"</select>",o+="<span> - </span>",o+='<select autocomplete="off" name="'+i+"["+r+'_close][]" class="wpsl-close-hour">'+v(!0)+"</select>",o+='<div class="wpsl-icon-cancel-circled"></div>',o+="</div>",n.find(".wpsl-store-closed").remove(),e("#wpsl-hours-"+r).append(o).end(),u(),t=24==e("#wpsl-editor-hour-format").val()?{open:"09:00",close:"17:00"}:{open:"9:00 AM",close:"5:00 PM"},n.find(".wpsl-open-hour:last option[value='"+t.open+"']").attr("selected","selected"),n.find(".wpsl-close-hour:last option[value='"+t.close+"']").attr("selected","selected"),s.preventDefault()}),e("#wpsl-editor-hour-format, #wpsl-editor-hour-interval").on("change",function(){v()}),e(".wpsl-info").on("mouseover",function(){e(this).find(".wpsl-info-text").show()}),e(".wpsl-info").on("mouseout",function(){e(this).find(".wpsl-info-text").hide()}),e("#wpsl-latlng").length&&!e("#wpsl-latlng").val()&&e("#wpsl-latlng").siblings("label").find(".wpsl-info").addClass("wpsl-required-setting"),e("#wpsl-map-style").val()&&h(),e("#wpsl-style-preview").on("click",function(){return h(),!1}),e("#wpsl-wrap").on("click","button.notice-dismiss",function(){e(this).closest("div.notice").remove()}),e("#wpsl-search-autocomplete, #wpsl-force-postalcode").change(function(){var s=e("#wpsl-force-postalcode").parent("p").find(".wpsl-info-zip-only");e("#wpsl-search-autocomplete").is(":checked")&&e("#wpsl-force-postalcode").is(":checked")?s.show():s.hide()}),e("#wpsl-delay-loading").change(function(){e(this).is(":checked")?e(this).parent("p").find(".wpsl-info").trigger("mouseover"):e(this).parent("p").find(".wpsl-info").trigger("mouseout")}),e("#wpsl-wrap").on("click",function(s){e(".wpsl-info-text").hide()})});